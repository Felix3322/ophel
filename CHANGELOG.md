# Changelog

所有重要更改都会记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
版本号遵循 [语义化版本](https://semver.org/lang/zh-CN/)。

---

## [1.0.5] - 2026-02-04

### 🚀 新增功能

- **大纲字数统计**：
  - **回复字数**：在大纲面板中，每个用户提问会显示对应 AI 回复的字数（如 `1.2k`、`3.5k`），方便评估回复内容量。
  - **标题字数**：每个标题节点也会显示其下属内容的字数，辅助内容结构分析。
  - **思维链排除**：自动排除 AI 的"思考过程"（Thinking/Reasoning）内容，仅统计实际回复字数。
  - **可选开关**：设置面板新增"显示字数统计"选项，默认开启，可按需关闭。
  - **格式优化**：超长数字自动格式化（1000 → 1k），保持界面简洁。

### 🔧 功能优化

- **AI Studio 虚拟滚动兼容**：为 AI Studio 添加字数缓存机制，解决虚拟滚动导致的字数丢失问题。
- **大纲高亮流程重构**：改为数据驱动流程，提高一致性与可维护性。
- **跟随模式优化**：仅在跟随模式下启用滚动高亮观察器，减少无效监听。
- **滚动跟踪稳定性**：提升高亮可见性与滚动跟踪稳定性。
- **开发体验**：降低 hooks 与日志相关的 lint 噪音。
- **设置禁用提示**：依赖项未开启时点击会提示需先开启对应前置设置，并加入提示节流避免频繁弹出。
- **快捷按钮组优化**：优化按钮分组与分隔逻辑，锚点提示支持本地化；手动锚点按钮默认关闭。
- **快捷按钮位置同步**：面板默认位置切换为左侧时，快捷按钮组同步移动到左侧。

### 🐛 问题修复

- **TypeScript 类型检查**：修复 `catch` 中错误变量丢失导致的 `pnpm typecheck` 失败问题。
- **Markdown 导出**：修复导出文件与复制到剪贴板时 Markdown 结构丢失的问题（标题/列表/代码块等恢复）。
- **Markdown 导出**：修复 Emoji 乱码的问题（使用 Unicode codepoint + UTF-8 BOM 确保编码正确）。
- **大纲滚动跟踪**：修复部分场景下滚动跟踪不稳定的问题。
- **大纲导航提示**：超长文本会清理空白并截断显示，避免提示溢出。

### ⚠️ 已知限制

- **Gemini Enterprise**：由于 Shadow DOM 限制，新回复需刷新页面才能正确显示字数。

## [1.0.4] - 2026-02-02

### 🚀 新增功能

- **大纲收藏系统 (Favorites)**：

  - **收藏功能**：支持对任意大纲节点进行收藏（点击节点右侧星号），重要内容触手可及。
  - **过滤模式**：工具栏新增“收藏模式”开关，开启后仅显示收藏内容及其上下文。
  - **智能上下文**：收藏模式下会自动展开收藏节点的路径，并智能隐藏无关节点，保持视图清爽。

- **页面内收藏 (Inline Bookmarks)**：

  - **即时收藏**：在页面正文的用户问题和 AI 回复标题旁直接显示收藏图标，无需打开侧边栏即可快速收藏。
  - **状态同步**：页面内收藏操作与大纲面板完全同步，实心黄色星星表示已收藏。
  - **智能显隐**：未收藏时图标半透明显示，鼠标悬浮时高亮，减少视觉干扰。

- **全局自定义 Tooltip 系统**：

  - **Premium 视觉**：引入统一的深色半透明拟态风格 Tooltip，替代原生浏览器提示，视觉效果更精致稳定。
  - **智能交互**：优化了大纲项操作按钮的 Tooltip 触发逻辑，支持进入子按钮时自动切换提示，并解决了嵌套触发导致的布局跳动。
  - **环境兼容**：解决了对话框（Portaled Dialogs）在 Shadow DOM 环境下的样式丢失问题。

- **UI 视觉升级**：

  - **图标优化**：重绘了工具栏和列表中的图标，使用更饱满锐利的圆角风格，提升精致度。
  - **布局优化**：优化了操作图标（复制、收藏）的布局和渐变遮罩，防止长文本遮挡。
  - **搜索框高亮**：统一了提示词与大纲搜索框的聚焦（Focus）样式，使用主题蓝色替代浏览器默认黑色边框，交互感更强。

- **大纲快捷键增强**：

  - 新增 `Alt + C`：快速切换大纲收藏模式。
  - 新增 `Alt + Shift + 4/5/6`：支持一键展开大纲至更深层级（4-6 级）。
  - 新增 `Alt + Shift + Q`：一键仅显示用户问题（自动开启显示并重置展开层级）。

- **面板宽度自定义**：新增面板宽度设置选项，支持在 200px 至 600px 之间自由调整面板宽度。
- **面板吸附优化**：改进边缘吸附（Edge Snap）的隐藏逻辑，吸附后始终保持 10px 的露出宽度，不再受面板宽度影响。

### 🔧 功能优化

- **全语言文案优化**：将原本含义模糊的“切换面板” (Toggle Panel) 在所有 10 种语言中统一优化为“展开/收起面板” (Expand/Collapse Panel)，交互意图更明确。

- **Tooltip 性能**：优化了 Tooltip 组件的测量与定位算法，支持 `disabled` Prop 动态禁用。
- **文本截断**：统一了所有站点适配器的大纲文本截断逻辑为 200 字符，并移除了硬编码的 "..." 后缀，交由 CSS 处理省略号。
- **全节点复制**：增强了复制功能，支持对所有大纲节点（包括普通标题和用户提问）进行全文复制，并智能提取完整文本。

- **配置体验升级**：
  - 引入 `NumberInput` 组件，彻底解决设置页输入框在中文输入法下的冲突及焦点丢失问题。
  - 调整面板默认高度为 85vh，提供更舒适的视觉体验。
  - 扩大面板默认边距的可调范围至 0-400px。
  - 优化吸附触发阈值默认值为 18px，减少误操作。
- **面板交互**：优化了面板在“边缘吸附”模式下的点击外部行为。现在点击外部区域会使面板缩回边缘（Retract to Edge），而不是最小化为悬浮球。
- **设置文案**：设置页中的"点击外部自动隐藏"描述现在会根据吸附状态动态更新，提供更准确的交互反馈。
- **锚点状态统一**：重构锚点管理机制，使用全局 `anchorStore` 替代分散在各组件中的独立状态，解决面板按钮、快捷键、QuickButtons 之间锚点不同步的问题。

### 🐛 问题修复

- **UI 修复**：修复了提示词搜索框缺失类名导致的聚焦样式失效问题。
- **大纲跟随**：增强滚动容器检测机制，修复部分站点下大纲无法正确跟随阅读进度的问题 by @urzeye
- **Markdown 修复**：解决流式输出场景下 Markdown 渲染修复功能的兼容性问题 by @urzeye
- **设置同步**：修复设置页输入值在编辑过程中可能被后台同步意外覆盖的问题 by @urzeye
- **位置同步**：修复了在吸附状态下切换面板默认位置时，吸附状态丢失或未正确跟随的问题。
- **初始化状态**：修复了在开启边缘吸附时，页面刷新后面板未能正确保持吸附状态的问题。
- **大纲导航**：修复了使用 `Alt + ↑/↓` 快捷键导航标题时，连续按键可能卡在同一项或跳转不准确的问题。现在通过"视口距离检查"自动区分连续导航和用户手动滚动。
- **AI Studio 书签修复**：
  - **Side-Channel Hydration**：解决了 AI Studio 因虚拟滚动/懒加载导致无法获取用户提问文本，进而导致大纲标题为空或丢失的问题。现在通过侧边栏 (`ms-prompt-scrollbar`) 智能回填文本。

## [1.0.3] - 2026-01-29

### 🚀 新增功能

- **ChatGPT Markdown 修复**：新增 ChatGPT 加粗文本渲染修复功能，解决 Markdown `**加粗**` 未正确渲染的问题 by @urzeye

### 🐛 问题修复

- support gemini multi-account `/u/<n>` URLs (keep single-user `/app` style) / 支持 gemini 多账户 `/u/<n>` URL（保留单用户 `/app` 风格） #16 by @lanvent
- **ChatGPT 登录问题**：修复了 ChatGPT 无法正常登录的问题 by @urzeye
- **Release 工作流**：修复了 GitHub Release 中 Full Changelog 比较链接缺少上一个版本号的问题 by @urzeye

### 🔧 功能优化

- **适配器重构**：将 Markdown 修复配置迁移到适配器模式，提升代码可维护性 by @urzeye

## [1.0.1] - 2026-01-23

### 🚀 新增功能

- **油猴脚本兼容**：提供 Tampermonkey/GreaseMonkey 脚本的完整构建支持，扩展了浏览器扩展之外的使用方式。
- **多语言文档**：发布并同步了 8 种额外语言（日语、韩语、繁体中文、德语、法语、西班牙语、葡萄牙语、俄语）的详细 README 文档。
- **工程化**：添加 Pull Request 模板以规范社区贡献。

### 🐛 问题修复

- **CI/CD**：优化了文档构建工作流，避免在仅更新 `docs` 目录下的 README 文件时触发不必要的构建。
- **文档**：修复了多语言文档中缺失的“演示”、“本地构建”和“Star History”章节。

## [1.0.0] - 2026-01-18

### 🎉 首次发布

这是 Ophel 的第一个正式版本，为 Gemini、ChatGPT、Claude、Grok 和 AI Studio 提供全方位的增强体验。

### ✨ 核心功能

#### 智能大纲导航

- 自动解析 AI 回复内容，生成可点击的目录大纲
- 支持多级标题层级结构
- 快速定位到指定内容位置

#### 会话管理

- 按文件夹整理对话
- 批量操作会话
- 会话搜索与定位
- 同步原生侧边栏置顶状态

#### 提示词库

- 内置丰富的提示词模板
- 支持自定义创建和编辑
- 分组管理与快速搜索
- 一键填充到输入框

#### 快捷键系统

- 提供丰富的键盘快捷键
- 支持自定义按键绑定
- 覆盖常用操作场景

#### 主题与外观

- 20+ 精心设计的主题
- 区分浅色/深色模式主题
- 支持自定义页面宽度

#### 阅读记录恢复

- 自动保存阅读位置
- 重新打开时恢复上次阅读进度
- 智能区分新内容

#### WebDAV 同步

- 支持同步设置到个人 WebDAV 服务器
- 多设备配置共享
- 完全自主掌控数据

### 🌐 平台支持

- **Gemini** - 完整功能支持
- **Gemini Business** - 完整功能支持
- **ChatGPT** - 完整功能支持
- **Claude** - 完整功能支持
- **Grok** - 完整功能支持
- **AI Studio** - 完整功能支持

### 🌍 多语言支持

- 简体中文
- 繁体中文
- English
- Deutsch
- Español
- Français
- 日本語
- 한국어
- Português
- Русский

### 🔒 隐私保护

- 所有数据本地存储
- 无远程数据收集
- 无第三方跟踪
- 开源透明

---

[1.0.5]: https://github.com/urzeye/ophel/releases/tag/v1.0.5
[1.0.4]: https://github.com/urzeye/ophel/releases/tag/v1.0.4
[1.0.3]: https://github.com/urzeye/ophel/releases/tag/v1.0.3
[1.0.1]: https://github.com/urzeye/ophel/releases/tag/v1.0.1
[1.0.0]: https://github.com/urzeye/ophel/releases/tag/v1.0.0
